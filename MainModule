local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local function SafeCreate(parent, className, properties)
    local obj = Instance.new(className)
    for k,v in pairs(properties) do
        obj[k] = v
    end
    obj.Parent = parent
    return obj
end

local DynaFlip = SafeCreate(CoreGui, "ScreenGui", {
    Name = "DynaFlipAdminPanel",
    ResetOnSpawn = false,
    ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
    DisplayOrder = 999
})

local DFButton = SafeCreate(DynaFlip, "TextButton", {
    Name = "DFCircleButton",
    Size = UDim2.new(0, 60, 0, 60),
    Position = UDim2.new(0, 20, 0.5, -30),
    AnchorPoint = Vector2.new(0, 0.5),
    BackgroundColor3 = Color3.fromRGB(45, 45, 60),
    Text = "DF",
    TextColor3 = Color3.new(1, 1, 1),
    Font = Enum.Font.GothamBlack,
    TextSize = 24,
    TextStrokeTransparency = 0,
    TextStrokeColor3 = Color3.fromRGB(200, 200, 255)
})

SafeCreate(DFButton, "UICorner", {CornerRadius = UDim.new(1, 0)})

local Border = SafeCreate(DFButton, "UIStroke", {
    Name = "AnimatedBorder",
    ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
    Color = Color3.fromRGB(100, 70, 200),
    Thickness = 3
})

local MainFrame = SafeCreate(DynaFlip, "Frame", {
    Name = "MainFrame",
    Size = UDim2.new(0, 350, 0, 400),
    Position = UDim2.new(0.5, -175, 0.5, -200),
    AnchorPoint = Vector2.new(0.5, 0.5),
    BackgroundColor3 = Color3.fromRGB(30, 30, 40),
    BackgroundTransparency = 0.1,
    BorderSizePixel = 0,
    ClipsDescendants = true,
    Visible = false
})

SafeCreate(MainFrame, "UICorner", {CornerRadius = UDim.new(0, 12)})

local TopBar = SafeCreate(MainFrame, "Frame", {
    Name = "TopBar",
    Size = UDim2.new(1, 0, 0, 40),
    Position = UDim2.new(0, 0, 0, 0),
    BackgroundColor3 = Color3.fromRGB(45, 45, 60),
    BorderSizePixel = 0
})

local Title = SafeCreate(TopBar, "TextLabel", {
    Name = "Title",
    Size = UDim2.new(0, 200, 1, 0),
    Position = UDim2.new(0.5, -100, 0, 0),
    BackgroundTransparency = 1,
    Text = "DynaFlip - لوحة التحكم",
    TextColor3 = Color3.new(1, 1, 1),
    Font = Enum.Font.GothamBold,
    TextSize = 18
})

local CloseButton = SafeCreate(TopBar, "TextButton", {
    Name = "CloseButton",
    Size = UDim2.new(0, 30, 0, 30),
    Position = UDim2.new(1, -35, 0.5, -15),
    BackgroundColor3 = Color3.fromRGB(200, 60, 60),
    Text = "X",
    TextColor3 = Color3.new(1, 1, 1),
    Font = Enum.Font.GothamBold,
    TextSize = 14
})

SafeCreate(CloseButton, "UICorner", {CornerRadius = UDim.new(0, 6)})

local ButtonsContainer = SafeCreate(MainFrame, "ScrollingFrame", {
    Name = "ButtonsContainer",
    Size = UDim2.new(1, -20, 1, -60),
    Position = UDim2.new(0, 10, 0, 50),
    BackgroundTransparency = 1,
    ScrollBarThickness = 5,
    CanvasSize = UDim2.new(0, 0, 0, 500)
})

local function CreateButton(text, color)
    local Button = SafeCreate(ButtonsContainer, "TextButton", {
        Name = text.."Button",
        Size = UDim2.new(1, 0, 0, 50),
        BackgroundColor3 = color,
        Text = text,
        TextColor3 = Color3.new(1, 1, 1),
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        AutoButtonColor = false
    })
    
    SafeCreate(Button, "UICorner", {CornerRadius = UDim.new(0, 8)})
    
    local HoverEffect = SafeCreate(Button, "Frame", {
        Name = "HoverEffect",
        Size = UDim2.new(0, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Color3.new(1, 1, 1),
        BackgroundTransparency = 0.8,
        BorderSizePixel = 0
    })
    
    SafeCreate(HoverEffect, "UICorner", {CornerRadius = UDim.new(0, 8)})
    
    Button.MouseEnter:Connect(function()
        pcall(function()
            TweenService:Create(HoverEffect, TweenInfo.new(0.3), {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 0.7
            }:Play()
        end)
    end)
    
    Button.MouseLeave:Connect(function()
        pcall(function()
            TweenService:Create(HoverEffect, TweenInfo.new(0.3), {
                Size = UDim2.new(0, 0, 1, 0),
                BackgroundTransparency = 0.8
            }:Play()
        end)
    end)
    
    Button.MouseButton1Click:Connect(function()
        pcall(function()
            local Pulse = TweenService:Create(Button, TweenInfo.new(0.2), {
                BackgroundTransparency = 0.5
            })
            Pulse:Play()
            task.wait(0.2)
            Pulse = TweenService:Create(Button, TweenInfo.new(0.3), {
                BackgroundTransparency = 0
            })
            Pulse:Play()
        end)
    end)
    
    return Button
end

local FlyButton = CreateButton("الطيران (Fly)", Color3.fromRGB(0, 120, 215))
local NoClipButton = CreateButton("المرور عبر الأشياء (NoClip)", Color3.fromRGB(0, 180, 120))
local BtoolsButton = CreateButton("أدوات البناء (Btools)", Color3.fromRGB(220, 160, 0))
local ServerLockButton = CreateButton("قفل السيرفر (ServerLock)", Color3.fromRGB(180, 0, 0))
local ShutdownButton = CreateButton("إيقاف السيرفر (Shutdown)", Color3.fromRGB(150, 0, 80))

local function ToggleMainFrame()
    pcall(function()
        MainFrame.Visible = not MainFrame.Visible
        if MainFrame.Visible then
            MainFrame.BackgroundTransparency = 1
            TweenService:Create(MainFrame, TweenInfo.new(0.3), {
                BackgroundTransparency = 0.1
            }):Play()
        end
    end)
end

local function Fly()
    pcall(function()
        local character = LocalPlayer.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Flying)
            end
        end
    end)
end

local function NoClip()
    pcall(function()
        local character = LocalPlayer.Character
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end)
end

local function GiveBtools()
    pcall(function()
        local backpack = LocalPlayer:FindFirstChildOfClass("Backpack")
        if backpack then
            local hammer = Instance.new("HopperBin")
            hammer.BinType = Enum.BinType.Hammer
            hammer.Parent = backpack
            
            local clone = Instance.new("HopperBin")
            clone.BinType = Enum.BinType.Clone
            clone.Parent = backpack
        end
    end)
end

local function ServerLock()
    pcall(function()
        game:GetService("ReplicatedStorage"):FindFirstChild("SetServerLocked", true).Value = true
    end)
end

local function ShutdownServer()
    pcall(function()
        game:GetService("ReplicatedStorage"):FindFirstChild("ShutdownServer", true):FireServer()
    end)
end

DFButton.MouseButton1Click:Connect(ToggleMainFrame)

CloseButton.MouseButton1Click:Connect(function()
    pcall(function()
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {
            BackgroundTransparency = 1
        }):Play()
        task.wait(0.3)
        MainFrame.Visible = false
    end)
end)

FlyButton.MouseButton1Click:Connect(Fly)
NoClipButton.MouseButton1Click:Connect(NoClip)
BtoolsButton.MouseButton1Click:Connect(GiveBtools)
ServerLockButton.MouseButton1Click:Connect(ServerLock)
ShutdownButton.MouseButton1Click:Connect(ShutdownServer)

local rotation = 0
RunService.RenderStepped:Connect(function(dt)
    pcall(function()
        rotation = (rotation + dt) % (2 * math.pi)
        Border.Color = Color3.fromHSV(rotation/(2*math.pi), 0.8, 1)
    end)
end)

DFButton.Visible = true